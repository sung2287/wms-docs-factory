# AI CLI Operational Playbook (Gemini ↔ Codex)

본 문서는 Gemini CLI와 Codex CLI를 하나의 통합된 실전 워크플로우로 운영하기 위한 **운영·판단 규약(Playbook)**입니다.

- **성격:** 본 문서는 "도구 기능 설명서"가 아니며, 특정 상황에서 **언제 어떤 도구를 써야 하는지**에 대한 판단 기준만을 정의합니다.
- **SSOT(Single Source of Truth):** 모든 명령어, 옵션, 기능의 정의는 다음 두 레퍼런스 문서를 절대 기준으로 합니다.
    - [Gemini CLI Reference Guide](./gemini_cli_full_reference.md)
    - [Codex CLI Reference Guide](./codex_cli_full_reference.md)

---

## 1. 도구 역할 헌법 (Tool Responsibility Charter)

| 구분 | Gemini CLI (The Researcher) | Codex CLI (The Executor) |
| :--- | :--- | :--- |
| **주요 목적** | 탐색, 근거 수집, 구조 요약, 계획 수립 | 코드 변경, 명령 실행, 자동화, 승인 처리 |
| **강점** | 대규모 컨텍스트 분석, 계층적 메모리(`GEMINI.md`) 관리 | 정밀한 파일 패치(`replace`), 비대화형 자동화(`exec`) |
| **금지 영역** | 승인 절차 없는 직접적인 코드 대량 수정 | 근거(Context) 탐색 없는 무분별한 실행 |
| **출력물 성격** | 분석 보고서, 작업 계획(`Plan`), 지침 문서 | 수정된 코드, 실행 결과, 체크포인트(Tag) |

---

## 2. AI CLI Playbook (시나리오별 워크플로우)

### 2.1 레포 구조 및 맥락 파악
1. **시작 도구:** Gemini CLI
2. **수행 목적:** `@` 기호를 이용한 디렉토리 분석 및 `GEMINI.md`를 통한 프로젝트 규칙 파악.
3. **기대 출력물:** 파일 구조 요약, 주요 로직 흐름도.
4. **전환 조건:** 수정이 필요한 특정 파일과 로직이 명확히 식별되었을 때.
5. **전환 시 도구:** Codex CLI

### 2.2 버그 원인 분석 및 진단
1. **시작 도구:** Gemini CLI
2. **수행 목적:** `grep_search` 및 파일 부분 읽기를 통해 오류 발생 지점과 원인 진단.
3. **기대 출력물:** 버그 발생 원인 분석 결과 및 수정 전략.
4. **전환 조건:** 수정 전략이 수립되고 실제 코드 반영이 필요한 시점.
5. **전환 시 도구:** Codex CLI

### 2.3 리팩토링 설계 및 실행
1. **시작 도구:** Gemini CLI
2. **수행 목적:** `/plan` 모드를 활용하여 대규모 리팩토링의 단계별 계획 수립.
3. **기대 출력물:** 에이전트가 제안한 단계별 작업 목록(Plan).
4. **전환 조건:** 계획 검토 완료 후 실제 파일 쓰기(Write) 작업을 수행할 때.
5. **전환 시 도구:** Codex CLI (`-a auto-edit` 모드 권장)

### 2.4 자동화 및 반복 작업
1. **시작 도구:** Codex CLI
2. **수행 목적:** `codex exec` 또는 `-q` 플래그를 이용한 스크립트 기반 자동화 작업.
3. **기대 출력물:** 대량의 파일 일괄 수정 또는 CI/CD 파이프라인 결과.
4. **전환 조건:** 자동화 과정에서 예기치 못한 구조적 충돌이나 분석이 필요한 오류 발생 시.
5. **전환 시 도구:** Gemini CLI (원인 재분석)

---

## 3. Gemini ↔ Codex 자동 라우팅 규칙표

| 입력 상황 / 사용자 의도 | 요구 행위 유형 | 사용 CLI | 이유 (역할 기준) | 다음 전환 조건 |
| :--- | :--- | :--- | :--- | :--- |
| "이 함수가 어디서 호출되는지 찾아줘" | **탐색** | **Gemini** | 코드베이스 전역 검색 및 관계 분석 최적화 | 호출 지점 확인 후 수정 필요 시 |
| "사용자 로그인 로직을 개선해줘" | **변경** | **Codex** | 파일 패치 및 실행 권한 제어(Approval) 필요 | 변경 후 영향도 재분석 필요 시 |
| "빌드 오류를 해결해줘" | **판단/실행** | **Gemini** | 오류 메시지 분석 및 근거 수집이 우선임 | 해결책 확정 후 적용 단계에서 Codex 전환 |
| "전체 파일에 라이선스 헤더 추가해" | **자동화** | **Codex** | 반복적인 대량 파일 수정(`exec`) 특화 | 작업 완료 후 무결성 검사 시 Gemini 전환 |

---

## 4. 전환 금지 규칙 (Safety Rules)

- **[탐색 우선]** 근거 수집(Gemini) 없이 Codex로 바로 코드 변경을 실행하지 않는다.
- **[구조 보호]** 대규모 변경 전 Gemini의 `/plan` 또는 `GEMINI.md`를 통한 영향 분석 단계를 생략하지 않는다.
- **[승인 필수]** Codex의 `Approval Mode`를 사용할 때, 중요한 시스템 파일 변경 시 `Suggest` 모드를 건너뛰고 `Full Auto`를 남용하지 않는다.
- **[복구 보장]** 대규모 작업 전 Codex의 `/chat save` 또는 Gemini의 `/chat save`를 통해 복구 가능한 체크포인트를 반드시 생성한다.

---

## 5. 레퍼런스 연결 가이드

- **Gemini CLI Reference:** 탐색 명령어(`glob`, `grep`), 메모리 관리(`/memory`), 계획 수립(`/plan`)의 세부 옵션이 궁금할 때 참고합니다.
- **Codex CLI Reference:** 승인 정책(`-a`), 비대화형 모드(`-q`), 자동화 명령(`exec`), 파일 정밀 수정(`replace`)의 세부 문법이 궁금할 때 참고합니다.
- **상호 관계:** Playbook은 **전략(Decision)**을, Reference는 **전술(Command Syntax)**을 제공합니다.

---
*Last Updated: 2024-02-21*
